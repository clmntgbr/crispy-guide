{% extends 'base.html.twig' %}

{% block body %}
    <div class="col-lg-12 chart_prices">
    </div>
{% endblock %}

{% block javascripts %}
    <script type="application/javascript" src="https://code.highcharts.com/highcharts.js"></script>

    <script>
        function loadCharts(element, gasType) {
            console.log(gasType)
            Highcharts.setOptions({
                lang: {
                    shortMonths: [
                        'Janvier', 'Février', 'Mars', 'Avril',
                        'Mai', 'Juin', 'Juillet', 'Août',
                        'Septembre', 'Octobre', 'Novembre', 'Décembre'
                    ],
                }
            })

            Highcharts.chart(gasType['reference'] + '_chart', {
                chart: {
                    borderWidth: 1,
                    spacingBottom: 45,
                    spacingTop: 25,
                    spacingLeft: 10,
                    spacingRight: 10,
                    borderColor: 'rgb(230, 230, 230)',
                    zoomType: 'x',
                    style: {
                        fontFamily: 'Raleway',
                    }
                },
                title: {
                    text: '<p style="font-family: Raleway-Bold, sans-serif;">Prix du  pour </p>',
                },
                xAxis: {
                    type: 'datetime'
                },
                yAxis: {
                    title: {
                        text: 'Prix (€)'
                    }
                },
                legend: {
                    enabled: false
                },
                plotOptions: {
                    area: {
                        marker: {
                            radius: 2
                        },
                        lineWidth: 1,
                        states: {
                            hover: {
                                lineWidth: 2
                            }
                        },
                        threshold: null
                    },
                    series: {
                        allowPointSelect: true
                    }
                },
                credits: {
                    enabled: false
                },
                tooltip: {
                    xDateFormat: '%d/%m/%Y',
                    pointFormat: ' : <b>{point.y} €</b>',
                    shared: true
                },
                series: [{
                    type: 'area',
                    fillOpacity: 0.5,
                    color: 'rgba(67,160,71,0.68)',
                    data: element
                }]
            })
        }

        function getGasPrices(value) {
            $.get({
                url: '{{ path('ajax_gas_station_id_gas_prices') }}',
                type: 'GET',
                async: true,
                data: {'year': value, 'gasStationId': '{{ gasStation.id }}'},
                success: function (elements) {
                    var data = []
                    var gasTypes = {}

                    $.each(elements, function (index, price) {
                        if (data.hasOwnProperty(price.gas_type_id)) {
                            data[price.gas_type_id].push([parseFloat(price.date_timestamp), parseFloat(price.value)])
                        } else {
                            data[price.gas_type_id] = []
                        }

                        if (false === gasTypes.hasOwnProperty(price.gas_type_id)) {
                            gasTypes[price.gas_type_id] = {id: price.gas_type_id, label: price.label, reference: price.reference}
                        }
                    })

                    data.forEach(function(item, index){
                        $('.chart_prices').append("<div id='" + gasTypes[index]['reference'] + "_chart'></div>")
                        loadCharts(item, gasTypes[index])
                    })
                }
            })
        }

        getGasPrices(null)

    </script>
{% endblock %}

